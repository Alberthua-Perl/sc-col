## üöÄ OVN Âú® OpenStack ‰∏≠ÁöÑÈõÜÊàê‰∏éÊµÅË°®ÂàÜÊûê

#### ÊñáÊ°£ËØ¥ÊòéÔºö

- OVN ÁâàÊú¨Ôºöovn2.13-20.06.2-11.el8fdp.x86_64

- OpenStack ÁâàÊú¨ÔºöRed Hat OpenStack Platform 16.1Ôºà‰ª•‰∏ãÁÆÄÁß∞ RHOSP 16.1Ôºâ

- ‰ª•‰∏ã ovn ‰∏é openstack ÂëΩ‰ª§ÂùáÂú® RHOSP 16.1 Âπ≥Âè∞‰∏äÈÄöËøáÊµãËØï„ÄÇ

- ÊâÄÊúâ OVN Áõ∏ÂÖ≥ÁªÑ‰ª∂ÂÖ®ÈÉ®ËøêË°å‰∫é `podman` ÂÆπÂô®‰∏≠„ÄÇ

- RHOSP 13.0 ‰∏é RHOSP 16.1 Âùá‰ΩøÁî® `OVN` ‰Ωú‰∏∫ SDN ÊéßÂà∂Âπ≥Èù¢Ôºå`OVS` ‰Ωú‰∏∫ SDN Êï∞ÊçÆËΩ¨ÂèëÂπ≥Èù¢„ÄÇ

- RHOSP 13.x Âü∫‰∫é‰∏äÊ∏∏Á§æÂå∫ `OpenStack Queens` ÂºÄÂèëÔºåËÄå RHOSP 16.x Âü∫‰∫é‰∏äÊ∏∏Á§æÂå∫ `OpenStack Train` ÂºÄÂèë„ÄÇ

- Áî±‰∫é Red Hat OpenShift Container Platform 4.x ‰∏≠‰ΩøÁî® `ovn-kubernetes` ‰Ωú‰∏∫Âü∫Á°Ä CNI Êèí‰ª∂ÔºåÂõ†Ê≠§ÊúâÂøÖË¶Å‰∫ÜËß£ OVN ÁöÑÊµÅÈáèË∑ØÂæÑÔºå‰ª•Ê≠§ÂØπ ovn-kubernetes Âú® OpenShift 4.x ‰∏≠ÁöÑ‰ΩøÁî®ÂÆûË∑µÊèê‰æõÊÄùË∑Ø„ÄÇ

- ËôΩÁÑ∂ÂÖ≥‰∫é OVN ÂÖ∑Êúâ‰∏ÄÂÆöÊï∞ÈáèÁöÑ‰∏≠ÊñáÂèÇËÄÉËµÑÊñôÔºå‰ΩÜÊòØÂ∞Ü OVN ‰∏é OpenStack Êï¥ÂêàÂπ∂ÂàÜÊûê OVS ÊµÅË°®ÁöÑ‰∏≠ÊñáÊñáÊ°£Âá†‰πéÊ≤°ÊúâÔºåÂõ†Ê≠§Â∏åÊúõËØ•ÊñáÊ°£ÁöÑÂÜÖÂÆπÂèØ‰∏∫Áõ∏ÂÖ≥Â∑•‰ΩúÁöÑÂ±ïÂºÄÊèê‰æõÊÄùË∑Ø„ÄÇ

  

#### ÊñáÊ°£ÁõÆÂΩïÔºö

- openstack ÁΩëÁªúÁõ∏ÂÖ≥ÂëΩ‰ª§Á§∫‰æã
- OVN Â∏∏Áî®ÂëΩ‰ª§Ê±áÊÄª
- Open Virtual NetworkÔºàOVNÔºâÊ¶ÇËø∞‰∏éÂàÜÊûê
- OVN Âú® OpenStack ‰∏≠ÁöÑÁΩëÁªúÊ®°Âºè
- OVN Ëá™ÊúçÂä°ÁΩëÁªú‰∏é‰æõÂ∫îÂïÜÁΩëÁªúÊãìÊâëÁ§∫‰æã
- OVN Ëá™ÊúçÂä°ÁΩëÁªúÊ®°ÂºèÁöÑ OVS ÊµÅË°®ÂàÜÊûê
- ÂèÇËÄÉÈìæÊé•



#### openstack ÁΩëÁªúÁõ∏ÂÖ≥ÂëΩ‰ª§Á§∫‰æãÔºö

- RHOSP 13.x ‰∏é RHOSP 16.x ‰∏≠ÂèØÂ∞Ü OVN ‰Ωú‰∏∫ SDN ÊéßÂà∂Âπ≥Èù¢ÔºåËÄå‰∏äÊ∏∏Á§æÂå∫‰ªé `OpenStack Stein` ÂºÄÂßãÈªòËÆ§‰ΩøÁî® OVN„ÄÇ
- Neutron Âú® OpenStack ÁöÑÁΩëÁªúÊû∂ÊûÑ‰∏≠‰∏çÂÜçÊèê‰æõ `Neutron L2/L3 Agent` ÁöÑÂäüËÉΩÔºåÂçïÁ∫ØÂè™ÂÅö `neutron-server` Êé•Êî∂ÂâçÁ´ØÁΩëÁªúÊìç‰ΩúËØ∑Ê±ÇÔºåÂ∞ÜËØ∑Ê±Ç‰º†ÈÄíËá≥ `OVN-ML2` Êèí‰ª∂ÔºåÂÜçÁªèÁî± OVN/OVS ÂÆûÁé∞ÈÄªËæëÁΩëÁªúÂà∞Áâ©ÁêÜÁΩëÁªúÁöÑÊò†Â∞Ñ„ÄÇ
- openstack ÁΩëÁªúÁõ∏ÂÖ≥ÂëΩ‰ª§ÂÆûÂàôÊòØÂèëÈÄÅ `RESTful` ËØ∑Ê±ÇËá≥ neutron-serverÔºåÁúüÊ≠£ÁöÑÊéßÂà∂‰∏éÊµÅÈáèËΩ¨ÂèëÁî± OVN/OVS ÂÆûÁé∞„ÄÇ

> üìåÊ≥®ÊÑèÔºöÈÉ®ÁΩ≤ OpenStack OVN ÁΩëÁªúÊû∂ÊûÑÁöÑÊÄùË∑Ø
>
> 1. ÂàõÂª∫‰∏éÈÖçÁΩÆÂ∫ïÂ±ÇÁâ©ÁêÜ underlay ÁΩëÁªú
> 2. ÂàõÂª∫ÂêÑ‰∏™ÊéßÂà∂ËäÇÁÇπ‰∏éËÆ°ÁÆóËäÇÁÇπ‰∏äÁî®‰∫éËøûÊé•Ëá≥‰∏çÂêåÁâ©ÁêÜÁΩëÁªúÁöÑ OVS ÁΩëÊ°•ÔºåÂ¶Ç br-ex„ÄÅbr-eth*X*„ÄÅbr-prov*X* Á≠â„ÄÇ
> 3. Âú® Neutron ML2 Êèí‰ª∂ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÔºåÂèØÊåáÂÆö flat„ÄÅvlan Êàñ geneve Á±ªÂûãÈ©±Âä®ÁöÑÁΩëÁªúËá≥ÊåáÂÆöÁöÑÁâ©ÁêÜÁΩëÁªú‰∏äÔºàÁâ©ÁêÜÁΩëÁªúÁöÑÂêçÁß∞ÂèØËá™ÂÆö‰πâÔºâ„ÄÇ
> 4. ovs-vsctl Êò†Â∞ÑÁî± ML2 ÂÆö‰πâÁöÑÁâ©ÁêÜÁΩëÁªúËá≥ÊåáÂÆöÁöÑ OVS ÁΩëÊ°•„ÄÇ
> 5. ‰ΩøÁî® openstack ÂëΩ‰ª§ÂàõÂª∫ÁßüÊà∑ÁΩëÁªúÊàñ‰æõÂ∫îÂïÜÁΩëÁªú„ÄÇ

```bash
# ----- OVN-ML2 Êèí‰ª∂‰∏é OpenStack ÈõÜÊàêÁöÑÈÖçÁΩÆËØ¥Êòé ----- #
root@controller0:
  $ grep -Ev "^#|^$" /var/lib/config-data/puppet-generated/neutron/etc/neutron/plugins/ml2/ml2_conf.ini 
    [DEFAULT]
    [ml2]
    type_drivers=geneve,vlan,flat
    tenant_network_types=geneve
    mechanism_drivers=ovn
    path_mtu=0
    extension_drivers=qos,port_security,dns
    overlay_ip_version=4
    [securitygroup]
    firewall_driver=iptables_hybrid
    [ml2_type_geneve]
    max_header_size=38
    vni_ranges=1:65536
    [ml2_type_vlan]
    network_vlan_ranges=datacentre:1:1000,vlanprovider1:101:104,vlanprovider2:101:104,storage:30:30
    [ml2_type_flat]
    flat_networks=datacentre
    [ovn]
    ovn_nb_connection=tcp:172.24.1.52:6641
    ovn_sb_connection=tcp:172.24.1.52:6642
    ovsdb_connection_timeout=180
    neutron_sync_mode=log
    ovn_l3_mode=True
    vif_type=ovs
    ovn_metadata_enabled=True
    enable_distributed_floating_ip=True
    dns_servers=
  # define provider network name to be mapped to node ovs bridge in 
  # OVS Open_vSwitch table field external-ids:ovn-bridge-mappings
  
  $ ovs-vsctl list Open_vSwitch . 
    _uuid               : da52b817-899b-459f-b486-b529fcbd9275
    bridges             : [3d1b126b-9813-4ca9-ae2b-5098fe3e74f9, 7f8f97ad-3e56-4f76-b959-f76c62240d02, 9af29d0f-b6c1-43c7-a323-
                          a419cad11426, a7f0d8fa-8379-4e6d-ac29-231b27aa96b1, cfc40889-cae6-49bd-bb7d-16c777845fdd]
    cur_cfg             : 192
    datapath_types      : [netdev, system]
    datapaths           : {}
    db_version          : "8.2.0"
    dpdk_initialized    : false
    dpdk_version        : "DPDK 19.11.1"
    external_ids        : {hostname=controller0.overcloud.example.com, ovn-bridge=br-int, ovn-bridge-mappings="datacentre:br-
                          ex,vlanprovider1:br-prov1,vlanprovider2:br-prov2,storage:br-trunk", ovn-cms-options=enable-chassis-as-gw, 
                          ovn-encap-ip="172.24.2.1",ovn-encap-type=geneve, ovn-openflow-probe-interval="60", ovn-remote="tcp:
                          172.24.1.52:6642", ovn-remote-probe-interval="60000",rundir="/var/run/openvswitch", 
                          system-id="daeaae52-3df0-4531-a07d-0111be0edb42"}
    iface_types         : [erspan, geneve, gre, internal, ip6erspan, ip6gre, lisp, patch, stt, system, tap, vxlan]
    manager_options     : []
    next_cfg            : 192
    other_config        : {}
    ovs_version         : "2.13.0"
    ssl                 : []
    statistics          : {}
    system_type         : rhel
    system_version      : "8.2"
		
  $ ovs-vsctl get Open_vSwitch . external-ids:ovn-bridge-mappings
    "datacentre:br-ex,vlanprovider1:br-prov1,vlanprovider2:br-prov2,storage:br-trunk"
  # ovn logical network mapping to physical underlay network

# ----- ÂàõÂª∫ OpenStack ‰æõÂ∫îÂïÜÁΩëÁªú ----- #
student@workstation:
  $ source admin-rc
  $ openstack network create \
    --external \
    --share \
    --provider-network-type vlan \
    --provider-physical-network vlanprovider1 \
    --provider-segment 103 \
    provider1-103
  # create external network mapping to physical network vlanprovider1

  $ openstack subnet create \
    --dhcp \
    --subnet-range=10.0.103.0/24 \
    --allocation-pool=start=10.0.103.100,end=10.0.103.149 \
    --network provider1-103 \
    subnet1-103

  $ source developer1-finance-rc
  $ openstack server create \
    --flavor default \
    --image rhel8 \
    --key-name example-keypair \
    --config-drive true \
    --network provider1-103 \
    --wait \
    finance-server1
  # create project vm instance
```

```bash
# ----- ÂàõÂª∫ OpenStack ÈÄªËæëË∑ØÁî±Âô® ----- #
student@workstation:
  $ source operator1-finance-rc 
  $ openstack router create finance-router1
  $ openstack router add subnet finance-router1 finance-subnet1
  $ openstack router set --external-gateway provider-datacentre finance-router1
  # If tenent network router doesn't exist, create the router to connect tenent
  # network and external network.

  * Note:
     1. Before creating ovn logical router there does not exist patch-provnet-<net_id>-to-br-int
        or patch-br-int-to-provnet-<net_id> patch port.
     2. Appear after creating ovn logical router.
     3. Of course you can install ovn2.13 rpm package through yum, then use ovn command
        to connect ovsdb directly. 

  $ openstack server create \
    --flavor m1.rhel8 \
    --image rhel8 \
    --nic net-id=finance-network1 \
    --config-drive true \
    --availability-zone nova:compute0.overcloud.example.com \
    --wait \
    finance-server1

  $ openstack server create \
    --flavor m1.rhel8 \
    --image rhel8 \
    --nic net-id=finance-network1 \
    --config-drive true \
    --availability-zone nova:compute1.overcloud.example.com \
    --wait \
    finance-server2

root@compute0:
  $ tcpdump -ten -i vlan20 | grep ICMP 
  # capture tenent geneve tunnel packets

# ----- Êü•Áúã Podman ÂÆπÂô®‰∏≠ OVN ÁªÑ‰ª∂ÁöÑÁΩëÁªúËØ¶ÁªÜ‰ø°ÊÅØ ----- #
root@controller0:
  $ podman inspect ovn_controller | jq .[0].HostConfig.NetworkMode
    "host"
  # ovn_controller container use host network namespace

  $ podman exec ovn_controller \
    ovn-nbctl --db=tcp:172.24.1.52:6641 show > finance-network1-nb-logical.txt
  # verify ovn logical switch and router

  $ podman exec -it ovn_controller \
    ovn-sbctl --db=tcp:172.24.1.52:6642 lflow-list finance-network1 > finance-network1-sb-flow.txt
  # verify ovn logical datapath flow

  $ podman exec ovn-dbs-bundle-podman-0 \
    ovn-nbctl --db=tcp:172.24.1.52:6641 list acl > finance-network1-nb-acl.txt
  # verify ovn logical network security group rule
  
  $ podman exec ovn_controller \
    ovn-nbctl --db=tcp:172.24.1.52:6641 list Logical_Router
  # verify ovn logical router in ovn network
```

```bash
# ----- OVN DHCP ÊúçÂä° ----- #
student@workstation:
  $ source developer1-finance-rc
  $ openstack port list --server finance-server3 -f json
    [
      {
        "ID": "422b1242-39bb-4fb8-9809-772bf6cf0d63",
        "Name": "",
        "MAC Address": "fa:16:3e:e1:c8:09",
        "Fixed IP Addresses": [
         {
            "subnet_id": "b4df8042-184b-494f-8a72-2ec171327408",
            "ip_address": "192.168.1.184"
          }
        ],
        "Status": "ACTIVE"
      }
    ]
  # verify instance port which is on ovn logical switch
  # instance NIC mac address is the same as ovn logical switch port

  $ podman exec ovn_controller \
    ovn-sbctl --db=tcp:172.24.1.52:6642 lflow-list | \
    grep 422b1242-39bb-4fb8-9809-772bf6cf0d63 | grep dhcp
      table=14(ls_in_dhcp_options ), priority=100  , match=(inport == "422b1242-39bb-4fb8-9809-772bf6cf0d63" && 
    eth.src == fa:16:3e:e1:c8:09 && ip4.src == 0.0.0.0 && ip4.dst == 255.255.255.255 && udp.src == 68 && udp.dst == 67), 
    action=(reg0[3] = put_dhcp_opts(offerip = 192.168.1.184, classless_static_route = {169.254.169.254/32,192.168.1.2, 
    0.0.0.0/0,192.168.1.1}, dns_server = {172.25.250.254}, lease_time = 43200, mtu = 1442, netmask = 255.255.255.0, 
    router = 192.168.1.1, server_id = 192.168.1.1); next;)
      table=14(ls_in_dhcp_options ), priority=100  , match=(inport == "422b1242-39bb-4fb8-9809-772bf6cf0d63" && 
    eth.src == fa:16:3e:e1:c8:09 && ip4.src == 192.168.1.184 && ip4.dst == {192.168.1.1, 255.255.255.255} && 
    udp.src == 68 && udp.dst == 67), action=(reg0[3] = put_dhcp_opts(offerip = 192.168.1.184, classless_static_route =
    {169.254.169.254/32,192.168.1.2, 0.0.0.0/0,192.168.1.1}, dns_server = {172.25.250.254}, lease_time = 43200, mtu = 1442, 
    netmask = 255.255.255.0, router = 192.168.1.1, server_id = 192.168.1.1); next;)
      table=15(ls_in_dhcp_response), priority=100  , match=(inport == "422b1242-39bb-4fb8-9809-772bf6cf0d63" && 
    eth.src == fa:16:3e:e1:c8:09 && ip4 && udp.src == 68 && udp.dst == 67 && reg0[3]), action=(eth.dst = eth.src; 
    eth.src = fa:16:3e:d8:4a:6a; ip4.src = 192.168.1.1; udp.src = 67; udp.dst = 68; outport = inport; flags.loopback = 1; 
    output;)
  # ovn for instance dhcp request and response progress
		
# ----- OVN ÂÆâÂÖ®ÁªÑÊúçÂä° ----- #
  $ openstack security group rule create --protocol tcp --dst-port 8080:8080 dev-web
  $ openstack security group list -f json
    {
      "ID": "3d8d9807-7f69-4b76-b8c1-5cd3f1168d81",
      "Name": "dev-web",
      "Description": "dev-web",
      "Project": "5d0b01fa01dc48d8b04e306d40edcaeb",
      "Tags": []
    }
  # create new security group rule
  $ echo 3d8d9807-7f69-4b76-b8c1-5cd3f1168d81 | tr - _
    3d8d9807_7f69_4b76_b8c1_5cd3f1168d81
	$ podman exec ovn_controller ovn-nbctl --db=tcp:172.24.1.52:6641 acl list
    ...
    _uuid               : 58a192c1-3eb4-4ac6-bc5d-8c01d57df9b1
    action              : allow-related
    direction           : to-lport
    external_ids        : {"neutron:security_group_rule_id"="f7d7a04d-045e-43a7-a3ae-16302bc6858d"}
    log                 : false
    match               : "outport == @pg_3d8d9807_7f69_4b76_b8c1_5cd3f1168d81 && ip4 && ip4.src == 0.0.0.0/0 && tcp && tcp.dst == 8080"
    meter               : []
    name                : []
    priority            : 1002
    severity            : []
    ...
```

```bash
### ÂàõÂª∫ÁöÑ‰∏§‰∏™ OpenStack ‰æõÂ∫îÂïÜÁΩëÁªúÂÖ±‰∫´Â∫ïÂ±Ç VLAN underlay ÁΩëÁªúÔºà10.0.104.0/24Ôºâ
student@workstation:
  $ source admin-rc
  $ openstack network create \
    --external \
    --share \
    --provider-network-type vlan \
    --provider-physical-network vlanprovider1 \
    --provider-segment 104 \
    provider1-104

  $ openstack subnet create \
    --dhcp \
    --subnet-range=10.0.104.0/24 \
    --allocation-pool=start=10.0.104.100,end=10.0.104.149 \
    --network provider1-104 \
    subnet1-104
  # vlanprovider1 mapped on br-prov1 ovs bridge which is attached by eth3
  # eth3 attached on kvm virbr1 linux bridge

  $ openstack network create \
    --external \
    --share \
    --provider-network-type vlan \
    --provider-physical-network vlanprovider2 \
    --provider-segment 104 \
    provider2-104

  $ openstack subnet create \
    --dhcp \
    --subnet-range=10.0.104.0/24 \
    --allocation-pool=start=10.0.104.150,end=10.0.104.199 \
    --network provider2-104 \
    subnet2-104
  # vlanprovider2 mapped on br-prov2 ovs bridge which is attached by eth4
  # eth4 attached on kvm virbr1 linux bridge

  $ source operator1-production-rc 
  $ openstack server create \
    --flavor default \
    --image rhel8 \
    --nic net-id=provider1-104 \
    --config-drive true \
    --key-name example-keypair \
    --security-group networking \
    --wait \
    production-server1

  $ openstack server create \
    --flavor default \
    --image rhel8 \
    --nic net-id=provider2-104 \
    --config-drive true \
    --key-name example-keypair \
    --security-group networking \
    --wait \
    production-server2
  # production-server{1,2} can communicate with each other through vlan 104 network.
```



#### OVN Â∏∏Áî®ÂëΩ‰ª§Ê±áÊÄªÔºö

- OVN notrhbound database ÂëΩ‰ª§Ôºö

  ```bash
  # OpenStack ‰∏≠‰ΩøÁî® OVN ÂëΩ‰ª§Êó∂ÔºåÈúÄÊåáÂÆöÂ¶Ç‰∏ãÁéØÂ¢ÉÂèòÈáèÔºåÊàñ‰ΩøÁî® --db=tcp:<ip>:<port> ÈÄâÈ°π„ÄÇ
  $ export OVN_NB_DB=tcp:172.24.1.50:6641
  # ÂØºÂá∫ OVN_NB_DB ÁéØÂ¢ÉÂèòÈáè
  $ export OVN_SB_DB=tcp:172.24.1.50:6642
  # ÂØºÂá∫ OVN_SB_DB ÁéØÂ¢ÉÂèòÈáè
  
  $ ovs-vsctl list Open_vSwitch
  # Êü•Áúã ovsdb Êï∞ÊçÆÂ∫ìÔºà/etc/openvswitch/conf.dbÔºâ‰∏≠ Open_vSwitch Ë°®ÁöÑ‰ø°ÊÅØ
  
  $ ovn-nbctl ls-list
  # Êü•Áúã OVN ÈÄªËæë‰∫§Êç¢Êú∫
  $ ovn-nbctl lr-list
  # Êü•Áúã OVN ÈÄªËæëË∑ØÁî±Âô®
  $ ovn-nbctl show [<ovn_logical_switch>|<ovn_logical_router>]
  # Êü•Áúã OVN ÂåóÂêëÊï∞ÊçÆÂ∫ìÁöÑÈÄªËæë‰∫§Êç¢Êú∫‰∏éË∑ØÁî±Âô®ÁöÑ‰ø°ÊÅØ
  $ ovn-nbctl lsp-list <ovn_logical_switch>
  # Êü•Áúã OVN ÈÄªËæë‰∫§Êç¢Êú∫Á´ØÂè£ 
  $ ovn-nbctl lrp-list <ovn_logical_router>
  # Êü•Áúã OVN ÈÄªËæëË∑ØÁî±Âô®Á´ØÂè£
  
  $ ovn-nbctl lr-route-list <ovn_logical_router>
  # Êü•Áúã OVN ÈÄªËæëË∑ØÁî±Âô®ÁöÑË∑ØÁî±‰ø°ÊÅØ
  $ ovn-nbctl lr-nat-list <ovn_logical_router>
  # Êü•Áúã OVN ÈÄªËæëË∑ØÁî±Âô®ÁöÑ NAT ‰ø°ÊÅØ
  
  $ ovn-nbctl dhcp-options-list
  # Êü•Áúã OVN ÁöÑ DHCP ‰ø°ÊÅØ
  $ ovn-nbctl dhcp-options-get-options <dhcp_options_uuid>
  # Êü•ÁúãÊåáÂÆö DHCP ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
  
  $ ovn-nbctl list <ovn_nb_db_table>
  # Êü•Áúã OVN ÂåóÂêëÊï∞ÊçÆÂ∫ìÁöÑÊåáÂÆöË°®
  $ ovn-nbctl list DHCP_Options
  # Êü•Áúã OVN ÂåóÂêëÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑ DHCP_Options Ë°®
  $ ovn-nbctl acl-list <ovn_logical_switch>
  # Êü•Áúã OVN ÈÄªËæë‰∫§Êç¢Êú∫ÁöÑ ACL ËßÑÂàôÔºàÂÆâÂÖ®ÁªÑËßÑÂàôÔºâ
  ```

- OVN southbound database ÂëΩ‰ª§Ôºö

  ```bash
  $ ovn-sbctl show
  # Êü•Áúã OVN ÂçóÂêëÊï∞ÊçÆÂ∫ìÁöÑ‰ø°ÊÅØ
  $ ovn-sbctl lflow-list
  # Êü•Áúã OVN ÂçóÂêëÊï∞ÊçÆÂ∫ìÁöÑÈÄªËæëÊµÅ
  $ ovn-sbctl list [Chassis|Encap|Logical_Flow|Datapath_Binding|Port_Binding]
  # Êü•Áúã OVN ÂçóÂêëÊï∞ÊçÆÂ∫ì‰∏≠ÊåáÂÆöË°®ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
  ```

- OVS and OpenFlow ÂëΩ‰ª§Ôºö

  ```bash
  $ ovs-vsctl show
  # Êü•Áúã OVS ÁΩëÊ°•‰∏éÁ´ØÂè£ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
  $ ovs-ofctl show <ovs_bridge>
  # Êü•Áúã OVS ÁΩëÊ°•‰∏éÁ´ØÂè£ÁöÑ flow ‰ø°ÊÅØ
  $ ovs-ofctl dump-ports-desc <ovs_bridge>
  # Êü•Áúã OVS ÁΩëÊ°•ÁöÑÁ´ØÂè£ÂàóË°®ËØ¶ÊÉÖ
  $ ovs-ofctl dump-tables <ovs_bridge>
  # Êü•Áúã OVS ÁöÑ OpenFlow ÊµÅË°®
  $ ovs-ofctl dump-flows <ovs_bridge>
  # Êü•Áúã OVS ÁöÑ OpenFlow ÊµÅ
  $ ovs-dpctl show
  # Êü•Áúã OVS ÁöÑ kernel datapath
  ```
  
  

#### Open Virtual NetworkÔºàOVNÔºâÊ¶ÇËø∞‰∏éÂàÜÊûêÔºö

- ËØ•ÈÉ®ÂàÜÂÜÖÂÆπÂèØËØ¶ÁªÜÂèÇÁúã‰πãÂâçÂèëÂ∏ÉÁöÑÊñáÊ°£Ôºö

  https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/docs/ovn-arch-introduce.md



#### OVN Âú® OpenStack ‰∏≠ÁöÑÁΩëÁªúÊ®°ÂºèÔºö

- OpenStack ÂØπÂÖ∂ÁΩëÁªúÁöÑÁÆ°ÁêÜËôΩÁÑ∂‰ªéÁî®Êà∑ËßíÂ∫¶ËÄåË®ÄÂπ∂Êú™ÂèëÁîüËøáÂ§öÂèòÂåñÔºåÂëΩ‰ª§Ë°å‰ΩøÁî®‰æùÁÑ∂ÂÖºÂÆπ‰ª•ÂâçÁâàÊú¨Ôºå‰ΩÜÊòØ SDN ÁöÑË∞ÉÁî®ÊñπÂºèÂ∑≤ÂÖ®Èù¢‰ªé Neutron Agent ÂàáÊç¢Ëá≥ OVN„ÄÇ

- RHOSP 13.xÔºàopenstack-queensÔºâ‰∏é RHOSP 16.xÔºàopenstack-trainÔºâ‰∏≠ÁöÑ OVN ÁΩëÁªúÊ®°ÂºèÔºåÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö
  - Ëá™ÊúçÂä°ÁΩëÁªúÔºàself-service networkÔºâÊàñÁß∞ÁßüÊà∑ÁΩëÁªúÔºàtenant networkÔºâÔºö`overlay` ÁΩëÁªú
  - ‰æõÂ∫îÂïÜÁΩëÁªúÔºàprovider networkÔºâÔºö`underlay` ÁΩëÁªú

- Ëá™ÊúçÂä°ÁΩëÁªúÊ®°ÂºèÊ¶ÇË¶ÅÔºö
  - Âêå‰∏ÄÂ≠êÁΩë‰∏≠ÂÆû‰æãÈó¥ÁöÑË∑®ËäÇÁÇπÈÄö‰ø°ÈÄöËøá Geneve ÈößÈÅìÂÆûÁé∞„ÄÇ

  - ËØ•Á±ªÂûãÁΩëÁªú‰∏≠ÁöÑÂÆû‰æãÂùáËøûÊé•Ëá≥ÁßüÊà∑Â≠êÁΩë‰∏≠ÔºåÈúÄÈÄöËøáÈÄªËæëË∑ØÁî±Âô®ËÆøÈóÆÂêå‰∏ÄÁßüÊà∑ÂÜÖ‰∏çÂêåÂ≠êÁΩëÂÜÖÁöÑÂÆû‰æã„ÄÅ‰∏çÂêåÁßüÊà∑Èó¥ÁöÑÂÆû‰æãÊàñÈõÜÁæ§Â§ñÁΩëÁªú„ÄÇ

  - Ëã•ÂÆû‰æãÊú™ÂàÜÈÖçÊµÆÂä® IPÔºà`fip`ÔºâÔºå‰ªéÂÆû‰æãËÆøÈóÆÂ§ñÈÉ®ÁΩëÁªúÊó∂Â∞Ü‰ΩøÁî® OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÔºà`ovn gateway router`ÔºåÊàñÁß∞ `Gateway_Chassis`ÔºâÁöÑ snat„ÄÇ

    > üëâ man-page ‰∏≠ÂÖ≥‰∫é Gateway_Chassis ÁöÑËØ¥ÊòéÔºö
    >
    > 1. Â¶ÇÊûúËÆæÁΩÆÔºåÂàôË°®Á§∫Ê≠§ÈÄªËæëË∑ØÁî±Âô®Á´ØÂè£‰ª£Ë°®‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁΩëÂÖ≥Á´ØÂè£ÔºåËØ•Á´ØÂè£Â∞ÜÊ≠§Ë∑ØÁî±Âô®ËøûÊé•Âà∞ÂÖ∑ÊúâÊú¨Âú∞ÁΩëÁªúÁ´ØÂè£Ôºà`localnet`ÔºâÁöÑÈÄªËæë‰∫§Êç¢Êú∫„ÄÇ 
    > 2. Âú®ÊØè‰∏™ÈÄªËæëË∑ØÁî±Âô®‰∏äÊúÄÂ§öÂèØ‰ª•Êúâ‰∏Ä‰∏™ËøôÊ†∑ÁöÑÈÄªËæëË∑ØÁî±Âô®Á´ØÂè£„ÄÇ 
    > 3. ÂØπ‰∫éÁªôÂÆöÁöÑÈÄªËæëË∑ØÁî±Âô®Á´ØÂè£ÔºåÂèØ‰ª•ÂºïÁî®Â§ö‰∏™ Gateway_Chassis„ÄÇ
    > 4. Âçï‰∏™ Gateway_Chassis Âú®ÂäüËÉΩ‰∏äÁõ∏ÂΩì‰∫éËÆæÁΩÆ `options:redirect-chassis`„ÄÇ
    >    ÊúâÂÖ≥ÁΩëÂÖ≥Â§ÑÁêÜÁöÑÊõ¥Â§öÁªÜËäÇÔºåËØ∑ÂèÇÈòÖ options:redirect-chassis ÁöÑÊèèËø∞„ÄÇ 
    > 5. ÂÆö‰πâÂ§ö‰∏™ Gateway_Chassis Â∞ÜÂêØÁî®ÁΩëÂÖ≥È´òÂèØÁî®ÊÄß„ÄÇ
    > 6. ‰∏ÄÊ¨°Âè™Êúâ‰∏Ä‰∏™ÁΩëÂÖ≥ÊòØÊ¥ªÂä®ÁöÑÔºåOVN Chassis Â∞Ü‰ΩøÁî® `BFD` Êù•ÁõëÊéß‰∏éÁΩëÂÖ≥ÁöÑËøûÊé•„ÄÇ 
    > 7. Â¶ÇÊûú‰∏éÊ¥ªÂä®ÁΩëÂÖ≥ÁöÑËøûÊé•Ë¢´‰∏≠Êñ≠ÔºåÂè¶‰∏Ä‰∏™ÁΩëÂÖ≥Â∞ÜÊàê‰∏∫Ê¥ªÂä®ÁöÑ„ÄÇ‰ºòÂÖàÁ∫ßÂàóÊåáÂÆö OVN ÈÄâÊã©ÁΩëÂÖ≥ÁöÑÈ°∫Â∫è„ÄÇ
    > 8. Â¶ÇÊûúËøûÊé•ÁöÑÈÄªËæëË∑ØÁî±Âô®Á´ØÂè£ÊåáÂÆö‰∫ÜÈáçÂÆöÂêë ChassisÔºåÂπ∂‰∏îÈÄªËæëË∑ØÁî±Âô®Âú® nat ‰∏≠‰ΩøÁî® external_mac ÊåáÂÆö‰∫ÜËßÑÂàôÔºåÈÇ£‰πàËøô‰∫õÂú∞ÂùÄ‰πüÁî®‰∫éÂ°´ÂÖÖ‰∫§Êç¢Êú∫ÁöÑÁõÆÁöÑÂú∞Êü•Êâæ„ÄÇ

  - ËØ• OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®Áî±ÊåáÂÆöÁöÑÁâ©ÁêÜËäÇÁÇπ Chassis ÂÆûÁé∞ÔºåÂç≥ÔºåËøêË°å‰∫éËÆ°ÁÆóËäÇÁÇπ‰∏äÁöÑÂÆû‰æãÊµÅÈáèÈáçÂÆöÂêëÔºàredirectÔºâËá≥ OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ÔºåÁî±ËØ•ËäÇÁÇπÂÆûÁé∞Â§ñÈÉ®ÁΩëÁªúËÆøÈóÆ„ÄÇ

  - OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®Âú®Á¨îËÄÖÁöÑÁéØÂ¢É‰∏≠Áî± `controller0` ÂçïËäÇÁÇπÂÆûÁé∞ÔºåÂ≠òÂú®ÂçïÁÇπÊïÖÈöúÂèØËÉΩÔºåÂõ†Ê≠§ÂèØÈááÁî®Â§öËäÇÁÇπ Chassis ÁªÑÊàê HA ÁªÑÔºà`ha-chassis-group-add`ÔºåËØ•Â≠êÂëΩ‰ª§‰ªé `OVN 2.12` ÁâàÊú¨ÂºÄÂßãÊîØÊåÅÔºâÔºåHA ÁªÑÊàêÁöÑËäÇÁÇπÁ±ªÂûãÂèØ‰ª•ÊòØÊéßÂà∂ËäÇÁÇπÊàñËÆ°ÁÆóËäÇÁÇπÂùáÂèØ„ÄÇ

  - ÁªÑÊàê HA ÁöÑ OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®Âêå‰∏ÄÊó∂ÂàªÂè™ËÉΩÁî±ÂÖ∂‰∏≠‰∏Ä‰∏™ËäÇÁÇπÂèëÊå•ÂäüËÉΩÔºåsnat ÁöÑÂÆûÁé∞ÂÆûË¥®‰∏ä‰æùÁÑ∂‰∏∫ÈõÜ‰∏≠ÂºèÁΩëÂÖ≥„ÄÇ
  
  - ‰ΩøÁî® OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ÁöÑÂÆû‰æãÊµÅÈáèÁöÑÈÄªËæëË∑ØÂæÑÔºö
  
    ```txt
    ÂÆû‰æã -> OVN ÈÄªËæë‰∫§Êç¢Êú∫ÔºàÂàÜÂ∏ÉÂºèÔºâ-> OVN ÈÄªËæëË∑ØÁî±Âô®ÔºàÂàÜÂ∏ÉÂºèÔºâ-> ÈáçÂÆöÂêëËá≥ OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÔºàÈõÜ‰∏≠ÂºèÔºâ-> OVN ÈÄªËæë‰∫§Êç¢Êú∫Ôºàlocalnet Á´ØÂè£Ôºâ-> Â§ñÈÉ®ÁΩëÁªú
    ```
  
  - ‰ΩøÁî® OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ÁöÑÂÆû‰æãÊµÅÈáèÁöÑÁâ©ÁêÜÊµÅÂêëÔºö
  
    > üîäÊ≥®ÊÑèÔºö‰ª•‰∏ãÊµÅÈáèÁöÑÁâ©ÁêÜÊµÅÂêëÊ†πÊçÆÁ¨îËÄÖÊâÄ‰ΩøÁî®ÁéØÂ¢ÉËÄåÂÆö„ÄÇ
  
    ```txt
    compute1 node:
    instance nic -> tap device -> ovs br-int -> ovn-port_uuid -> ovs br-trunk vlan20 port -> eth1 -> ...Geneve tunnel...
    controller0 node:
    ...Geneve tunnel... -> eth1 -> ovs br-trunk vlan20 port -> ovn-port_uuid -> ovs br-int -> patch-br-int-to port -> patch-to-br-int port -> ovs br-ex -> eth2 -> external network
  
  - Ê≠§Á±ªÂûãÁöÑ OVN ÈÄªËæëË∑ØÁî±Âô®ÈÄªËæëÂá∫Á´ØÂè£‰Ωç‰∫éÂÆû‰æãÊâÄÂú®ÁöÑËÆ°ÁÆóËäÇÁÇπÔºàlrp Á±ªÂûãÁ´ØÂè£ÔºâÔºåËØ•Á´ØÂè£Âú® OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπ‰∏äÂØπÂ∫îÁöÑÁ´ØÂè£‰∏∫ `cr-lrp` Á±ªÂûãÁ´ØÂè£ÔºàÂàÜÂ∏ÉÂºèÁΩëÂÖ≥Á´ØÂè£Ôºå`distributed gateway port`ÔºâÔºåËá™ËÆ°ÁÆóËäÇÁÇπÂá∫ lrp Á´ØÂè£ÁöÑÊµÅÈáèÂ∞ÜÈÄöËøáË∑®ËäÇÁÇπÈó¥ÁöÑ `Geneve` ÈößÈÅìÈáçÂÆöÂêë‰∫é OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÁöÑ cr-lrp Á±ªÂûãÁ´ØÂè£„ÄÇ
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/man-5-ovn-nb-distributed-gateway-ports.jpg)
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-logical-switch-demo.jpg)
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-logical-router-and-gateway-chassis.jpg)
  
  - Ëã•ÂÆû‰æãÂàÜÈÖçÊµÆÂä® IPÔºàfipÔºâÔºå‰ªéÂÆû‰æãÂÜÖÈÉ®Âà∞Â§ñÈÉ®ÁΩëÁªúÁöÑ‰∫íËÆøÊµÅÈáèÂùáÂú®ÂÆû‰æãÊâÄÂú®ÁöÑËÆ°ÁÆóËäÇÁÇπ‰∏äÂÆûÁé∞Ôºà`dnat_and_snat`ÔºâÔºåOVN ÈÄªËæëË∑ØÁî±Âô®‰Ωú‰∏∫ÁΩëÂÖ≥Â≠òÂú®‰∫éÊØè‰∏™ËÆ°ÁÆóËäÇÁÇπÁöÑ OVS br-int ÁΩëÊ°•‰∏≠ÔºåÊµÅÈáè‰∏çÂÜçÁªèËøá Gateway_Chassis„ÄÇ
  
    > üîäÊ≥®ÊÑèÔºö‰πãÂêéÁöÑÂÜÖÂÆπÂ∞ÜËØ¶ÁªÜÂàÜÊûê OVS ÊµÅË°®‰∏≠ÊâÄÊ∂âÂèäÂà∞ÁöÑ‰ª•‰∏äËøáÁ®ãÔºÅ
  
- ‰æõÂ∫îÂïÜÁΩëÁªúÊ®°ÂºèÊ¶ÇË¶ÅÔºö
  - ËØ•ÁΩëÁªúÊ®°Âºè‰∏çÂÜç‰æùËµñ‰∫é OVN ÁöÑ `overlay` ÁΩëÁªúÂäüËÉΩÔºåËÄåÊòØÂ∞ÜÂÆû‰æãÁõ¥Ëøû OVS br-int ÁΩëÊ°•ÔºåÂπ∂Áõ¥Êé•Êò†Â∞ÑËá≥Â§ñÈÉ®ÊâÄÊèê‰æõÁöÑÁâ©ÁêÜ `underlay` ÁΩëÁªú‰∏ä„ÄÇ
  - ÂÆû‰æãÁöÑ IP Âú∞ÂùÄÁî± OpenStack ÂàõÂª∫ÁöÑ‰æõÂ∫îÂïÜÁΩëÁªúÁöÑ IP Âú∞ÂùÄÊ±†ÊâÄÂàÜÈÖçÔºåËØ• IP Âú∞ÂùÄÊ±†Áî±Áâ©ÁêÜ underlay ÁΩëÁªúÊèê‰æõ„ÄÇ
  - ÂÆû‰æã IP ÁöÑËá™Âä®ÂàÜÈÖç‰æùÁÑ∂Áî± OVN DHCP ÊúçÂä°Êèê‰æõÔºåL3 Ë∑ØÁî±ÈúÄÂ§ñÈÉ®Ë∑ØÁî±Âô®Êèê‰æõ„ÄÇ



#### OVN Ëá™ÊúçÂä°ÁΩëÁªú‰∏é‰æõÂ∫îÂïÜÁΩëÁªúÊãìÊâëÁ§∫‰æãÔºö

- ü§ò RHOSP 13.0 & 16.1 Â§öÁßüÊà∑Èó¥ OVN ÈÄªËæëÁΩëÁªú‰∫íËøûÁ§∫‰æãÔºö

  ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-multi-tenant-network-connect.jpg)

- ü§ò RHOSP 13.0 & 16.1 OVN ÁßüÊà∑ÁΩëÁªú‰∏é‰æõÂ∫îÂïÜÁΩëÁªúÊ®°ÂºèÂèäÊµÅÈáèÁ±ªÂûãÁ§∫‰æãÔºö

  ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-tenant-and-provider-network-demo.png)



#### OVN Ëá™ÊúçÂä°ÁΩëÁªúÊ®°ÂºèÁöÑ OVS ÊµÅË°®ÂàÜÊûêÔºö

- ÁªèÁî± OVN ÂçóÂåóÂêëÊï∞ÊçÆÂ∫ìÂ§ÑÁêÜÁöÑÊµÅÈáèÊúÄÁªàÈÉΩ‰ºöÂåπÈÖçÂà∞ÂçóÂåóÂêëÊéßÂà∂ËäÇÁÇπ‰∏é‰∏úË•øÂêëËÆ°ÁÆóËäÇÁÇπÁöÑ OVS ÊµÅË°®ÔºåÂõ†Ê≠§Ë¶Å‰∫ÜËß£ OVN ÈÄªËæëÁΩëÁªúÊãìÊâë‰∏éÂêÑËäÇÁÇπÁâ©ÁêÜÂèäËôöÊãüÁΩëÁªúÊãìÊâëÈó¥ÁöÑÂÖ≥Á≥ªÈúÄË¶ÅÁêÜËß£ÂêÑËäÇÁÇπÁöÑ OVS br-int ÁΩëÊ°•‰∏≠ÁöÑÊµÅË°®Ôºà`OpenFlow table`Ôºâ„ÄÇ
- Âõ†Ê≠§ÔºåÊ†πÊçÆ "RHOSP 13.0 & 16.1 OVN ÁßüÊà∑ÁΩëÁªú‰∏é‰æõÂ∫îÂïÜÁΩëÁªúÊ®°ÂºèÂèäÊµÅÈáèÁ±ªÂûãÁ§∫‰æã" ‰∏≠ÁöÑÊµÅÈáèÁ±ªÂûãËøõË°åÂ¶Ç‰∏ãÊµÅË°®ÂàÜÊûêÔºö
  - Âêå‰∏ÄÁßüÊà∑ÂÜÖ‰∏çÂêåÂÆû‰æãÁöÑË∑®ËäÇÁÇπÈó¥ Geneve ÈößÈÅìÈÄö‰ø°ÔºàÂõæ‰æã‰∏≠ËìùËâ≤ËôöÁ∫øË°®Á§∫Ôºâ
  - ‰ΩøÁî®ÁßüÊà∑ÂÜÖÈÉ® IP Âú∞ÂùÄ‰∏é OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÂØπÂ§ñÈÉ®ÁΩëÁªúÁöÑËÆøÈóÆÔºàÂõæ‰æã‰∏≠ÁªøËâ≤ËôöÁ∫øË°®Á§∫Ôºâ
  - ‰ªéÂ§ñÈÉ®Áõ¥Êé•ËÆøÈóÆËÆ°ÁÆóËäÇÁÇπ‰ª•ËÆøÈóÆËøêË°å‰∫éËÆ°ÁÆóËäÇÁÇπ‰πã‰∏äÁöÑÂÖ∑ÊúâÊµÆÂä® IPÔºàfipÔºâÁöÑÂÆû‰æãÔºàÂõæ‰æã‰∏≠Á∫¢Ëâ≤ËôöÁ∫øË°®Á§∫Ôºâ
- OVS ÊµÅË°®Âú® OVN ÈÄªËæëÁΩëÁªú‰∏≠ÁöÑÈÉ®ÂàÜÂäüËÉΩÔºö

<img src="https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-flow-table.png" style="zoom:80%;" />



- Âêå‰∏ÄÁßüÊà∑ÂÜÖ‰∏çÂêåÂÆû‰æãÁöÑË∑®ËäÇÁÇπÈó¥ Geneve ÈößÈÅìÈÄö‰ø°Ôºö
  
  - Â¶ÇÂõæÊâÄÁ§∫Ôºå‰Ωç‰∫é finance ÁßüÊà∑‰∏≠ÁöÑ‰∏§‰∏™ÂÆû‰æã finance-instance1 ‰∏é finance-instance2 ÂàÜÂà´‰Ωç‰∫é compute0 ËäÇÁÇπ‰∏é compute1 ËäÇÁÇπÔºå‰∏§ËÄÖÈó¥ÁöÑÈÄö‰ø°‰æùËµñ‰∫é Geneve ÈößÈÅì„ÄÇ
  
  - ÂèëÈÄÅËøáÁ®ãÔºöcompute0 ËäÇÁÇπ
  
    <img src="https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-1.png" style="zoom:80%;" />
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-2.png)
  
    - ‰ªéÂÆû‰æãÂèëÂá∫ÁöÑÊï∞ÊçÆÂåÖËøõÂÖ• OVS br-int ÁΩëÊ°•ÁöÑÁ´ØÂè£ 4 ÂêéÔºåÁªèËøá table0 Â§ÑÁêÜÔºåËøõË°åÁâ©ÁêÜÁΩëÁªúËá≥ÈÄªËæëÁΩëÁªúËΩ¨Êç¢ÔºåËØ•Êï∞ÊçÆÂåÖÈÄöËøá metadata ‰∏∫ **`0x4`** ÁöÑ DatapathÔºàÈÄªËæë‰∫§Êç¢Êú∫Ôºâ‰∏äÁöÑ **`0x4`** ÈÄªËæëÂÖ•Á´ØÂè£ËøõÂÖ• OVN ÈÄªËæëÁΩëÁªú„ÄÇ
  
      ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-3.png)
  
      ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-4.png)
  
    - Êõ¥ÊîπÊï∞ÊçÆÂåÖÂú® DatapathÔºàÈÄªËæë‰∫§Êç¢Êú∫Ôºâ‰∏äÁöÑÈÄªËæëÂá∫Á´ØÂè£ **`reg15`**„ÄÇ
  
      ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-5.png)
  
    - Êï∞ÊçÆÂåÖÈÄöËøá metadata ‰∏∫ **`0x4`** ÁöÑ DatapathÔºàÈÄªËæë‰∫§Êç¢Êú∫ÔºâÁöÑÈÄªËæëÂá∫Á´ØÂè£ **`0x3`**ÔºåÂπ∂ËøõË°å Geneve ÈößÈÅìÂ∞ÅË£ÖÔºåÊúÄÁªàÈÄöËøá OVN ÈößÈÅìÁ´ØÂè£‰ªéËØ•ËÆ°ÁÆóËäÇÁÇπÂèëÂá∫„ÄÇ
  
  - Êé•Êî∂ËøáÁ®ãÔºöcompute1 ËäÇÁÇπ  
  
    <img src="https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-6.png" style="zoom:67%;" />
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-7.png)
  
    - ‰ªé OVN ÈößÈÅìÁ´ØÂè£Êé•Êî∂ÂÖ∂‰ªñËÆ°ÁÆóËäÇÁÇπÂèëÊù•ÁöÑÊï∞ÊçÆÂåÖÔºåËøõË°å Geneve ÈößÈÅìËß£Â∞ÅË£ÖÔºåÂπ∂Ê∑ªÂä† DatapathÔºàÈÄªËæë‰∫§Êç¢Êú∫ÔºâÁöÑ metadata„ÄÇ
  
      ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovs-openflow-rule-8.png)
  
    - Êï∞ÊçÆÂåÖÊúÄÁªàÁî± OVS br-int ÁΩëÊ°•ÁöÑÁ´ØÂè£ 8 ËΩ¨ÂèëËá≥ÁõÆÊ†áÂÆû‰æã„ÄÇ
  
  - ‰∏§ËäÇÁÇπÈó¥ÁöÑ tcpdump ‰∏é Wireshark ÊäìÂåÖÂàÜÊûêÔºö
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/host-geneve-tunnel-1.png)
  
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/host-geneve-tunnel-2.png)



- üöÄ ‰ΩøÁî®ÁßüÊà∑ÂÜÖÈÉ® IP Âú∞ÂùÄ‰∏é OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÂØπÂ§ñÈÉ®ÁΩëÁªúÁöÑËÆøÈóÆÔºö

  - Áî±‰∫éÂÆû‰æãÈÄöËøáÁßüÊà∑ÂÜÖ `DHCP` Ëá™Âä®ÂàÜÈÖçÁöÑ IP Âú∞ÂùÄÔºåÊú™Ë¢´ÂàÜÈÖçÊµÆÂä® IPÔºàfipÔºâÔºåÂõ†Ê≠§Êó†Ê≥ïÈÄöËøáÂ§ñÈÉ®ÁΩëÁªúËÆøÈóÆËØ•ÂÆû‰æãÔºåÂè™ËÉΩ‰ªéÂÆû‰æãÂÜÖÈÉ®ÈÄöËøá OVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπËÆøÈóÆÂ§ñÈÉ®ÁΩëÁªú„ÄÇ

  - ÂÆû‰æãËÆøÈóÆÂ§ñÈÉ®ÁΩëÁªúÊµÅÈáèÈúÄÁªèËøáÂÖ∂ÊâÄÂú®ÁöÑ compute1 ËäÇÁÇπ‰∏é controller0 ËäÇÁÇπÔºàOVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÔºâ„ÄÇ

  - Ëã•Ë¶ÅÁêÜËß£Êï¥‰∏™ OVN ÈÄªËæëÁΩëÁªúÁöÑÊµÅÈáèÊµÅÂêëÔºåÈúÄÁêÜÊ∏Ö OVN ÈÄªËæë‰∫§Êç¢Êú∫„ÄÅË∑ØÁî±Âô®„ÄÅÈÄªËæëÁ´ØÂè£Âú® OVS br-int ÊµÅË°®‰∏≠ÁöÑÁ¥¢ÂºïÂè∑ÔºåÂõ†Ê≠§ÔºåÈúÄÂÆö‰Ωç OVN ÂçóÂêëÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑ `Datapath_Binding` Ë°®‰∏é `Port_Binding` Ë°®‰∏≠ÁöÑ‰ø°ÊÅØ„ÄÇ

  - Â¶Ç‰∏ãÊâÄÁ§∫ÔºåÂÆû‰æãÊâÄÂú®ÁöÑ OVN ÈÄªËæëÁΩëÁªúÊ¶ÇË¶ÅÔºö

    ```bash
    # ----- OVN ÂåóÂêëÊï∞ÊçÆÂ∫ìÔºöOVN ÈÄªËæë‰∫§Êç¢Êú∫„ÄÅOVN ÈÄªËæëË∑ØÁî±Âô®Ê¶ÇË¶Å ----- #
    $ ovn-nbctl --db=tcp:172.24.1.52:6641 show
      ...
      switch 49e6b8c6-9518-4008-8f21-0cec5a14f3af (neutron-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5) (aka finance-network1)
          port abf6278c-3423-4b74-b5d2-4b5e8fb61f97
              type: localport
              addresses: ["fa:16:3e:f6:f4:7f 192.168.1.2"]
          port 3446de15-64ba-4010-bc16-a95296434bd5
              addresses: ["fa:16:3e:5a:58:2a 192.168.1.154"]
          port 3212a613-0433-43d5-aeed-eb5121cc1234
              type: router
              router-port: lrp-3212a613-0433-43d5-aeed-eb5121cc1234
      switch 3a35f933-277e-4f34-b913-4bde7f8a1128 (neutron-275c889d-ef54-4a38-88ff-a7cedee11506) (aka provider-datacentre)
          port 0416a971-ac51-4a5d-80a7-c95d2e397506
              type: router
              router-port: lrp-0416a971-ac51-4a5d-80a7-c95d2e397506
          port 521a09b2-f35d-4de2-8088-e421fe2395b9
              type: localport
              addresses: ["fa:16:3e:2e:64:cb"]
          port provnet-275c889d-ef54-4a38-88ff-a7cedee11506
              type: localnet
              addresses: ["unknown"]
      router a24077ec-d2c3-42f1-a81f-ed5fce6bc8d4 (neutron-8662d54e-0954-4239-ad75-2a7dad0e377b) (aka finance-router1)
          port lrp-3212a613-0433-43d5-aeed-eb5121cc1234
              mac: "fa:16:3e:94:2b:aa"
              networks: ["192.168.1.1/24"]
          port lrp-0416a971-ac51-4a5d-80a7-c95d2e397506
              mac: "fa:16:3e:d8:a1:f2"
              networks: ["172.25.250.139/24"]
              gateway chassis: [daeaae52-3df0-4531-a07d-0111be0edb42]
          nat 198ac241-3a33-4440-a666-0834c904bbc1
              external ip: "172.25.250.139"
              logical ip: "192.168.1.0/24"
              type: "snat"
      ...
    ```
    > üìåÊ≥®ÊÑèÔºö
    >
    > 1. Âú® ovs br-int ÊµÅË°®‰∏≠ÁöÑ `metadata` Â≠óÊÆµÂØπÂ∫îÊØè‰∏™ OVN ÈÄªËæë‰∫§Êç¢Êú∫Êàñ OVN ÈÄªËæëË∑ØÁî±Âô®Âú® OVN ÂçóÂêëÊï∞ÊçÆÂ∫ì `Datapath_Binding` Êï∞ÊçÆË∑ØÂæÑË°®ÁöÑ `tunnel_key` Â±ûÊÄßÔºåÂèØÊ†πÊçÆ metadata Â≠óÊÆµÁ°ÆÂÆö flow Â±û‰∫éÂì™‰∏™ OVN ÈÄªËæëËÆæÂ§á„ÄÇ
    > 2. Áî±‰∫éÊØè‰∏™ OVN ÈÄªËæëËÆæÂ§áÂùáÁªëÂÆö‰∏Ä‰∏™Êï∞ÊçÆË∑ØÂæÑÔºåÂõ†Ê≠§ÔºåËã•Âú® ovs br-int ÊµÅË°®‰∏≠‰ªé OVN ÈÄªËæë‰∫§Êç¢Êú∫ÈÄªËæëÂá∫Á´ØÂè£ÊµÅÂá∫ÁöÑÊï∞ÊçÆÂåÖËøõÂÖ• OVN ÈÄªËæëË∑ØÁî±Âô®ÈÄªËæëÂÖ•Á´ØÂè£Êó∂Ôºåmetadata Â≠óÊÆµÂ∞ÜÊîπÂèòÔºÅ

    ```bash
    # ----- OVN ÂçóÂêëÊï∞ÊçÆÂ∫ìÔºöDatapath_Binding Êï∞ÊçÆË∑ØÂæÑÁªëÂÆöË°® ----- #
    $ ovn-sbctl --db=tcp:172.24.1.52:6642 list Datapath_Binding
      _uuid               : 4aa0552d-8627-4136-8530-f1c28ce417f1
      external_ids        : {logical-switch="4e5e2601-c1e4-474c-a4e0-a0cc3d524b12", name=neutron-d71997c1-1670-4ebe-b6f7-2c4aa8dcbc7b, name2=lb-mgmt-net}
      tunnel_key          : 1
    
      _uuid               : c3da5aad-8659-491e-8a4d-291ccd651399
      external_ids        : {logical-switch="3a35f933-277e-4f34-b913-4bde7f8a1128", name=neutron-275c889d-ef54-4a38-88ff-a7cedee11506, name2=provider-datacentre}
      tunnel_key          : 2
    
      _uuid               : a0d4a875-adc7-4fcc-b672-61de8b148dbf
      external_ids        : {logical-switch="8311be4d-b6c3-4cfd-b1f8-b44b218510b1", name=neutron-dcf783e3-c104-4f21-99c3-0093364b4c81, name2=provider-storage}
      tunnel_key          : 3
    
      _uuid               : bb6ba376-b2ee-4608-93e8-fc8b6ab5fe15
      external_ids        : {logical-router="a24077ec-d2c3-42f1-a81f-ed5fce6bc8d4", name=neutron-8662d54e-0954-4239-ad75-2a7dad0e377b, name2=finance-router1}
      tunnel_key          : 6
    
      _uuid               : 6b2b21ef-c46b-4d0f-9f21-c729db444ce1
      external_ids        : {logical-switch="1f74dc81-abb3-4100-bba3-9acfd9a88844", name=neutron-d75263e1-754d-4276-a663-9188216f86e6, name2=production-network1}
      tunnel_key          : 5
    
      _uuid               : 68127ef3-0822-4c4a-aa66-6e4610318e81
      external_ids        : {logical-switch="49e6b8c6-9518-4008-8f21-0cec5a14f3af", name=neutron-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5, name2=finance-network1}
      tunnel_key          : 4
    ```

    ```bash
    $ ovn-sbctl --db=tcp:172.24.1.52:6642 Port_Binding
    # Êü•ÁúãÊØè‰∏™ OVN ÈÄªËæë‰∫§Êç¢Êú∫‰∏é OVN ÈÄªËæëË∑ØÁî±Âô®ÁöÑÈÄªËæëÁ´ØÂè£‰ø°ÊÅØ
    ```

    >üìåÊ≥®ÊÑèÔºö
    >
    >1. ÊØè‰∏™ OVN ÈÄªËæëÂÖ•Á´ØÂè£ÁöÑ tunnel_key ÂØπÂ∫î ovs br-int ÊµÅË°®‰∏≠ÁöÑ `reg14` Â≠óÊÆµ„ÄÇ
    >2. ÊØè‰∏™ OVN ÈÄªËæëÂá∫Á´ØÂè£ÁöÑ tunnel_key ÂØπÂ∫î ovs br-int ÊµÅË°®‰∏≠ÁöÑ `reg15` Â≠óÊÆµ„ÄÇ

    ```bash
    _uuid               : 1638f309-075a-468d-b022-4011c08ae02c
    chassis             : []
    datapath            : bb6ba376-b2ee-4608-93e8-fc8b6ab5fe15
    encap               : []
    external_ids        : {}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : lrp-0416a971-ac51-4a5d-80a7-c95d2e397506
    mac                 : ["fa:16:3e:d8:a1:f2 172.25.250.139/24"]
    nat_addresses       : []
    options             : {ipv6_prefix="false", ipv6_prefix_delegation="false", peer="0416a971-ac51-4a5d-80a7-c95d2e397506"}
    parent_port         : []
    tag                 : []
    tunnel_key          : 2
    type                : patch
    virtual_parent      : []
    
    _uuid               : 0e998b8a-d349-4861-8391-0d8342dee2c4
    chassis             : ee5cff61-76b2-42d3-b27b-2645c5c94f38
    datapath            : bb6ba376-b2ee-4608-93e8-fc8b6ab5fe15
    encap               : []
    external_ids        : {}
    gateway_chassis     : []
    ha_chassis_group    : 0d5471be-e772-4d47-a399-6c96b96af1bb
    logical_port        : cr-lrp-0416a971-ac51-4a5d-80a7-c95d2e397506
    mac                 : ["fa:16:3e:d8:a1:f2 172.25.250.139/24"]
    nat_addresses       : []
    options             : {distributed-port=lrp-0416a971-ac51-4a5d-80a7-c95d2e397506}
    parent_port         : []
    tag                 : []
    tunnel_key          : 3
    type                : chassisredirect
    virtual_parent      : []
    
    _uuid               : f2f1309a-399a-435a-b8a1-d2a7519fcb53
    chassis             : []
    datapath            : c3da5aad-8659-491e-8a4d-291ccd651399
    encap               : []
    external_ids        : {"neutron:cidrs"="172.25.250.139/24", "neutron:device_id"="8662d54e-0954-4239-ad75-2a7dad0e377b", "neutron:device_owner"="network:router_gateway", "neutron:network_name"=neutron-275c889d-ef54-4a38-88ff-a7cedee11506, "neutron:port_name"="", "neutron:project_id"="", "neutron:revision_number"="4", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "0416a971-ac51-4a5d-80a7-c95d2e397506"
    mac                 : [router]
    nat_addresses       : ["fa:16:3e:d8:a1:f2 172.25.250.139 is_chassis_resident(\"cr-lrp-0416a971-ac51-4a5d-80a7-c95d2e397506\")"]
    options             : {peer=lrp-0416a971-ac51-4a5d-80a7-c95d2e397506}
    parent_port         : []
    tag                 : []
    tunnel_key          : 3
    type                : patch
    virtual_parent      : []
    
    _uuid               : 0e829fd2-2fac-479d-85a7-2082ea859aa0
    chassis             : b1845743-6335-484d-956a-9b70ff75a2d8
    datapath            : 68127ef3-0822-4c4a-aa66-6e4610318e81
    encap               : []
    external_ids        : {"neutron:cidrs"="192.168.1.2/24", "neutron:device_id"=ovnmeta-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5, "neutron:device_owner"="network:dhcp", "neutron:network_name"=neutron-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5, "neutron:port_name"="", "neutron:project_id"="5d0b01fa01dc48d8b04e306d40edcaeb", "neutron:revision_number"="2", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "abf6278c-3423-4b74-b5d2-4b5e8fb61f97"
    mac                 : ["fa:16:3e:f6:f4:7f 192.168.1.2"]
    nat_addresses       : []
    options             : {requested-chassis=""}
    parent_port         : []
    tag                 : []
    tunnel_key          : 1
    type                : localport
    virtual_parent      : []
    
    _uuid               : ef7cc2e2-b49e-4fea-9690-e81017cf8ee6
    chassis             : []
    datapath            : c3da5aad-8659-491e-8a4d-291ccd651399
    encap               : []
    external_ids        : {"neutron:cidrs"="", "neutron:device_id"=ovnmeta-275c889d-ef54-4a38-88ff-a7cedee11506, "neutron:device_owner"="network:dhcp", "neutron:network_name"=neutron-275c889d-ef54-4a38-88ff-a7cedee11506, "neutron:port_name"="", "neutron:project_id"="50e6fca93606496b8a6c043957e4cb1d", "neutron:revision_number"="1", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "521a09b2-f35d-4de2-8088-e421fe2395b9"
    mac                 : ["fa:16:3e:2e:64:cb"]
    nat_addresses       : []
    options             : {requested-chassis=""}
    parent_port         : []
    tag                 : []
    tunnel_key          : 2
    type                : localport
    virtual_parent      : []
    
    _uuid               : 0fa8566b-8021-44da-bb27-bea20b75daa2
    chassis             : ee5cff61-76b2-42d3-b27b-2645c5c94f38
    datapath            : 4aa0552d-8627-4136-8530-f1c28ce417f1
    encap               : []
    external_ids        : {name=octavia-health-manager-controller0.overcloud.example.com-listen-port, "neutron:cidrs"="172.23.3.42/16", "neutron:device_id"="", "neutron:device_owner"="Octavia:health-mgr", "neutron:network_name"=neutron-d71997c1-1670-4ebe-b6f7-2c4aa8dcbc7b, "neutron:port_name"=octavia-health-manager-controller0.overcloud.example.com-listen-port, "neutron:project_id"="50e6fca93606496b8a6c043957e4cb1d", "neutron:revision_number"="5", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "79ad0f7e-f219-4c5f-8799-ed75fdde5b5f"
    mac                 : ["fa:16:3e:cd:df:d4 172.23.3.42", unknown]
    nat_addresses       : []
    options             : {requested-chassis=controller0.overcloud.example.com}
    parent_port         : []
    tag                 : []
    tunnel_key          : 2
    type                : ""
    virtual_parent      : []
    
    _uuid               : 17ddcd4b-5dad-4419-a811-c93cb9a91eab
    chassis             : []
    datapath            : bb6ba376-b2ee-4608-93e8-fc8b6ab5fe15
    encap               : []
    external_ids        : {}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : lrp-3212a613-0433-43d5-aeed-eb5121cc1234
    mac                 : ["fa:16:3e:94:2b:aa 192.168.1.1/24"]
    nat_addresses       : []
    options             : {ipv6_prefix="false", ipv6_prefix_delegation="false", peer="3212a613-0433-43d5-aeed-eb5121cc1234"}
    parent_port         : []
    tag                 : []
    tunnel_key          : 1
    type                : patch
    virtual_parent      : []
    
    _uuid               : 2665306c-a275-400e-bfde-3c8d21714927
    chassis             : []
    datapath            : c3da5aad-8659-491e-8a4d-291ccd651399
    encap               : []
    external_ids        : {}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : provnet-275c889d-ef54-4a38-88ff-a7cedee11506
    mac                 : [unknown]
    nat_addresses       : []
    options             : {network_name=datacentre}
    parent_port         : []
    tag                 : []
    tunnel_key          : 1
    type                : localnet
    virtual_parent      : []
    
    _uuid               : 2f8ab86d-40a8-4658-972a-d3dc0babe196
    chassis             : []
    datapath            : a0d4a875-adc7-4fcc-b672-61de8b148dbf
    encap               : []
    external_ids        : {"neutron:cidrs"="172.24.3.200/24", "neutron:device_id"=ovnmeta-dcf783e3-c104-4f21-99c3-0093364b4c81, "neutron:device_owner"="network:dhcp", "neutron:network_name"=neutron-dcf783e3-c104-4f21-99c3-0093364b4c81, "neutron:port_name"="", "neutron:project_id"="50e6fca93606496b8a6c043957e4cb1d", "neutron:revision_number"="2", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "0333b0c7-a3ee-4c03-bb59-994bc03a5e2f"
    mac                 : ["fa:16:3e:d6:9d:82 172.24.3.200"]
    nat_addresses       : []
    options             : {requested-chassis=""}
    parent_port         : []
    tag                 : []
    tunnel_key          : 2
    type                : localport
    virtual_parent      : []
    
    _uuid               : f4cd046d-4738-4f52-9654-95956b3ca5a1
    chassis             : []
    datapath            : a0d4a875-adc7-4fcc-b672-61de8b148dbf
    encap               : []
    external_ids        : {}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : provnet-dcf783e3-c104-4f21-99c3-0093364b4c81
    mac                 : [unknown]
    nat_addresses       : []
    options             : {network_name=storage}
    parent_port         : []
    tag                 : 30
    tunnel_key          : 1
    type                : localnet
    virtual_parent      : []
    
    _uuid               : c5b9bd25-becf-4bce-a053-b694f25e3db9
    chassis             : []
    datapath            : 4aa0552d-8627-4136-8530-f1c28ce417f1
    encap               : []
    external_ids        : {"neutron:cidrs"="172.23.0.2/16", "neutron:device_id"=ovnmeta-d71997c1-1670-4ebe-b6f7-2c4aa8dcbc7b, "neutron:device_owner"="network:dhcp", "neutron:network_name"=neutron-d71997c1-1670-4ebe-b6f7-2c4aa8dcbc7b, "neutron:port_name"="", "neutron:project_id"="50e6fca93606496b8a6c043957e4cb1d", "neutron:revision_number"="2", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "c2d0d0f4-8185-4cc4-a9f4-21008e49192c"
    mac                 : ["fa:16:3e:13:26:5c 172.23.0.2"]
    nat_addresses       : []
    options             : {requested-chassis=""}
    parent_port         : []
    tag                 : []
    tunnel_key          : 1
    type                : localport
    virtual_parent      : []
    
    _uuid               : ead38b06-ca3a-49d2-a23d-1153a2f6d799
    chassis             : []
    datapath            : 6b2b21ef-c46b-4d0f-9f21-c729db444ce1
    encap               : []
    external_ids        : {"neutron:cidrs"="192.168.1.2/24", "neutron:device_id"=ovnmeta-d75263e1-754d-4276-a663-9188216f86e6, "neutron:device_owner"="network:dhcp", "neutron:network_name"=neutron-d75263e1-754d-4276-a663-9188216f86e6, "neutron:port_name"="", "neutron:project_id"="5b51457605f64326a7fac5f66654045e", "neutron:revision_number"="2", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "6dc02ff1-006b-4fe0-8290-fa2187531166"
    mac                 : ["fa:16:3e:48:a0:84 192.168.1.2"]
    nat_addresses       : []
    options             : {requested-chassis=""}
    parent_port         : []
    tag                 : []
    tunnel_key          : 1
    type                : localport
    virtual_parent      : []
    
    _uuid               : 737b22ee-149c-4eaa-ae06-e0529b73cf8c
    chassis             : []
    datapath            : 68127ef3-0822-4c4a-aa66-6e4610318e81
    encap               : []
    external_ids        : {"neutron:cidrs"="192.168.1.1/24", "neutron:device_id"="8662d54e-0954-4239-ad75-2a7dad0e377b", "neutron:device_owner"="network:router_interface", "neutron:network_name"=neutron-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5, "neutron:port_name"="", "neutron:project_id"="5d0b01fa01dc48d8b04e306d40edcaeb", "neutron:revision_number"="3", "neutron:security_group_ids"=""}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "3212a613-0433-43d5-aeed-eb5121cc1234"
    mac                 : [router]
    nat_addresses       : []
    options             : {peer=lrp-3212a613-0433-43d5-aeed-eb5121cc1234}
    parent_port         : []
    tag                 : []
    tunnel_key          : 2
    type                : patch
    virtual_parent      : []
    
    _uuid               : db65c687-19a8-4cac-8870-ffe7574f161d
    chassis             : b1845743-6335-484d-956a-9b70ff75a2d8
    datapath            : 68127ef3-0822-4c4a-aa66-6e4610318e81
    encap               : []
    external_ids        : {"neutron:cidrs"="192.168.1.154/24", "neutron:device_id"="b692bf70-8fac-4005-90af-96c1f38488f1", "neutron:device_owner"="compute:nova", "neutron:network_name"=neutron-e6a61a45-ff39-4eb1-aac2-8e0ac624f7e5, "neutron:port_name"="", "neutron:project_id"="5d0b01fa01dc48d8b04e306d40edcaeb", "neutron:revision_number"="6", "neutron:security_group_ids"="390b4a25-4acf-48d4-a720-65a04d8278d2"}
    gateway_chassis     : []
    ha_chassis_group    : []
    logical_port        : "3446de15-64ba-4010-bc16-a95296434bd5"
    mac                 : ["fa:16:3e:5a:58:2a 192.168.1.154"]
    nat_addresses       : []
    options             : {requested-chassis=compute1.overcloud.example.com}
    parent_port         : []
    tag                 : []
    tunnel_key          : 3
    type                : ""
    virtual_parent      : []
    ```

  - ÂÆû‰æãÊµÅÈáè‰ªé compute1 ËäÇÁÇπÁöÑ ovs br-int ovn Êé•Âè£Â∞ÅË£Ö‰∏∫ Geneve ÈößÈÅìÊï∞ÊçÆÂåÖÁöÑÂΩ¢ÂºèÈáçÂÆöÂêëËá≥ controller0 ËäÇÁÇπÔºàOVN ÁΩëÂÖ≥Ë∑ØÁî±Âô®ËäÇÁÇπÔºâÔºå‰ªéÂÆû‰æãÂèëÂá∫ÁöÑÊï∞ÊçÆÂåÖÂú® ovs br-int ÁΩëÊ°•‰∏≠ÂåπÈÖçÁöÑÊµÅË°®ËßÑÂàôÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö

    ```bash
    student@workstationÔºö
     $ source operator1-finance-rc
     $ openstack port list | grep fa:16:3e:94:2b:aa
       | 3212a613-0433-43d5-aeed-eb5121cc1234 | fa:16:3e:94:2b:aa | ip_address='192.168.1.1', subnet_id='b4df8042-184b-494f-8a72-2ec171327408'    | ACTIVE |
     # Êü•ÁúãÂÆû‰æãÊâÄÂú®ÁöÑÁßüÊà∑Â≠êÁΩëÁöÑÂØπÂÜÖÁΩëÂÖ≥Âú∞ÂùÄ
     
    root@compute1:
     $ ovs-ofctl dump-ports-desc br-int
       OFPST_PORT_DESC reply (xid=0x2):
       ...
       3(ovn-daeaae-0): addr:66:1c:e0:97:33:3c
           config:     0
           state:      0
           speed: 0 Mbps now, 0 Mbps max
       4(tap3446de15-64): addr:fe:16:3e:5a:58:2a
           config:     0
           state:      0
           current:    10MB-FD COPPER
           speed: 10 Mbps now, 0 Mbps max
       ...
     # Êü•ÁúãÂÆû‰æãÁΩëÂè£ËøûÊé•ÁöÑ tap ËÆæÂ§á‰∏é ovn ÈößÈÅìÁ´ØÂè£Âú® ovs br-int ÁΩëÊ°•‰∏äÁöÑÁ¥¢ÂºïÂè∑   
    ```

    ```bash
    $ ovs-ofctl dump-flows br-int
      cookie=0xdb65c687, duration=34235.449s, table=0, n_packets=17759, n_bytes=1708588, idle_age=330, priority=100,in_port=4 actions=load:0x1->NXM_NX_REG13[],load:0x7->NXM_NX_REG11[],load:0x3->NXM_NX_REG12[],load:0x4->OXM_OF_METADATA[],load:0x3->NXM_NX_REG14[],resubmit(,8)
      # ‰ªéÂÆû‰æãÂèëÂá∫ÁöÑÊï∞ÊçÆÂåÖÈÄöËøá 4 Âè∑Á´ØÂè£Ôºàin_port=4ÔºâËøõÂÖ• ovs br-int ÁΩëÊ°•Ôºå‰ªéÁâ©ÁêÜÁΩëÁªúËøõÂÖ•ÈÄªËæëÁΩëÁªú„ÄÇ
      # Áî±‰∏äËø∞ OVN ÂçóÂêëÊï∞ÊçÆÂ∫ìÊâÄÁü•ÔºåÊï∞ÊçÆÂåÖÈÄöËøáÈÄªËæëÂÖ•Á´ØÂè£Ôºà0x3ÔºâËøõÂÖ• OVN ÈÄªËæë‰∫§Êç¢Êú∫Ôºàmetadata=0x4Ôºâ„ÄÇ
      cookie=0x8bec76c5, duration=34235.440s, table=8, n_packets=17759, n_bytes=1708588, idle_age=330, priority=50,reg14=0x3,metadata=0x4,dl_src=fa:16:3e:5a:58:2a actions=resubmit(,9)
      # MAC Âú∞ÂùÄ fa:16:3e:5a:58:2a ‰∏∫ ÂÆû‰æãÁΩëÂè£ MACÔºåIP Âú∞ÂùÄ 192.168.1.154 ‰∏∫ÂÆû‰æã IP Âú∞ÂùÄ„ÄÇ
      cookie=0x9262d250, duration=34235.439s, table=9, n_packets=17216, n_bytes=1684714, idle_age=330, priority=90,ip,reg14=0x3,metadata=0x4,dl_src=fa:16:3e:5a:58:2a,nw_src=192.168.1.154 actions=resubmit(,10)
      cookie=0x2264da97, duration=34235.436s, table=9, n_packets=1, n_bytes=342, idle_age=34184, priority=90,udp,reg14=0x3,metadata=0x4,dl_src=fa:16:3e:5a:58:2a,nw_src=0.0.0.0,nw_dst=255.255.255.255,tp_src=68,tp_dst=67 actions=resubmit(,10)
      cookie=0x6f980da0, duration=34235.440s, table=9, n_packets=700, n_bytes=58578, idle_age=340, priority=0,metadata=0x4 actions=resubmit(,10)
      cookie=0x2ee5013a, duration=34235.439s, table=10, n_packets=518, n_bytes=21756, idle_age=340, priority=90,arp,reg14=0x3,metadata=0x4,dl_src=fa:16:3e:5a:58:2a,arp_spa=192.168.1.154,arp_sha=fa:16:3e:5a:58:2a actions=resubmit(,11)
      cookie=0x5df244e1, duration=34235.443s, table=10, n_packets=17399, n_bytes=1721878, idle_age=330, priority=0,metadata=0x4 actions=resubmit(,11)
      cookie=0x8e0a6f42, duration=34235.440s, table=11, n_packets=17217, n_bytes=1685056, idle_age=330, priority=100,ip,metadata=0x4 actions=load:0x1->NXM_NX_XXREG0[96],resubmit(,12)
      cookie=0xe146b7bb, duration=34235.444s, table=12, n_packets=17917, n_bytes=1743634, idle_age=330, priority=0,metadata=0x4 actions=resubmit(,13) 
      cookie=0x5c4455c9, duration=34235.440s, table=13, n_packets=17217, n_bytes=1685056, idle_age=330, priority=100,ip,reg0=0x1/0x1,metadata=0x4 actions=ct(table=14,zone=NXM_NX_REG13[0..15])
      cookie=0xf7ee025, duration=34235.436s, table=13, n_packets=700, n_bytes=58578, idle_age=340, priority=0,metadata=0x4 actions=resubmit(,14) 
      cookie=0x9fac5dfc, duration=34235.436s, table=14, n_packets=44, n_bytes=4312, idle_age=33845, priority=65535,ct_state=-new+est-rel+rpl-inv+trk,ct_label=0/0x1,metadata=0x4 actions=resubmit(,15)
      cookie=0xc343943e, duration=34235.439s, table=14, n_packets=17034, n_bytes=1669320, idle_age=330, priority=2002,ct_state=-new+est-rpl+trk,ct_label=0/0x1,ip,reg14=0x3,metadata=0x4 actions=resubmit(,15)
      cookie=0xf4be381d, duration=34235.439s, table=14, n_packets=139, n_bytes=11424, idle_age=345, priority=2002,ct_state=+new-est+trk,ip,reg14=0x3,metadata=0x4 actions=load:0x1->NXM_NX_XXREG0[97],resubmit(,15)
      cookie=0xed768947, duration=34235.444s, table=14, n_packets=700, n_bytes=58578, idle_age=340, priority=0,metadata=0x4 actions=resubmit(,15) 
      ...
      cookie=0x5f0ed5ff, duration=34235.444s, table=27, n_packets=17215, n_bytes=1684378, idle_age=330, priority=50,metadata=0x4,dl_dst=fa:16:3e:94:2b:aa actions=load:0x2->NXM_NX_REG15[],resubmit(,32)
      # Êï∞ÊçÆÂåÖÁªèËøá OVN ÈÄªËæë‰∫§Êç¢Êú∫Ôºàmetadata=0x4ÔºâÁöÑËΩ¨ÂèëÈÄöËøáÈÄªËæëÂá∫Á´ØÂè£Ôºàreg15=0x2ÔºâËøõÂÖ• OVN ÈÄªËæëË∑ØÁî±Âô®ÁöÑÂØπÂÜÖÁΩëÂÖ≥Êé•Âè£Ôºàfa:16:3e:94:2b:aaÔºâ„ÄÇ
      cookie=0xe998b8a, duration=34235.449s, table=32, n_packets=17007, n_bytes=1664991, idle_age=330, priority=100,reg15=0x3,metadata=0x6 actions=load:0x6->NXM_NX_TUN_ID[0..23],set_field:0x3->tun_metadata0,move:NXM_NX_REG14[0..14]->NXM_NX_TUN_METADATA0[16..30],output:3
      # ËøõÂÖ• OVN ÈÄªËæëË∑ØÁî±Âô®Ôºàmetadata=0x6ÔºâÁöÑÊï∞ÊçÆÂåÖÈÄöËøáÈÄªËæëÂá∫Á´ØÂè£Ôºàreg15=0x3, cr-lrp-0416a971-ac51-4a5d-80a7-c95d2e397506ÔºâÂá∫Ë∑ØÁî±Âô®ÔºåÂπ∂ÈÄöËøá ovs br-int ÁΩëÊ°•ÁöÑ 3 Âè∑ ovn ÈößÈÅìÁ´ØÂè£Â∞ÅË£Ö Geneve ÈößÈÅìÂèëÂá∫„ÄÇ
      # Geneve ÈößÈÅìÂ∞ÅË£ÖÁöÑÊï∞ÊçÆÂåÖÂ∞ÜÈáçÂÆöÂêëËá≥ controller0 ËäÇÁÇπ„ÄÇ
      
      # ÊÄªÁªìÔºö
      #   OVN ÈÄªËæëË∑ØÁî±Âô®ÁöÑÈÄªËæëÂá∫Á´ØÂè£ lrp-0416a971-ac51-4a5d-80a7-c95d2e397506 ÁöÑÂàÜÂ∏ÉÂºèÁΩëÂÖ≥Á´ØÂè£‰Ωç‰∫é controller0 ËäÇÁÇπÔºå
      #   Âõ†Ê≠§ÈößÈÅìÊµÅÈáèÂ∞ÜÈáçÂÆöÂêëËá≥ controller0 ËäÇÁÇπ„ÄÇ
    ```

    ‰∏∫‰∫ÜÈ™åËØÅ‰ª•‰∏äÁªìÊûúÔºåÂàÜÂà´Âú® compute1 ËäÇÁÇπÁöÑ eth2 ÁΩëÂè£ÔºàÂØπÊé• 172.25.250.0/24 Â§ñÈÉ®ÁΩëÁªúÔºâ‰∏é vlan20 Êé•Âè£ÔºàGeneve ÈößÈÅìÁΩëÁªúÔºâ‰∏äÊäìÂåÖÔºåÁªìÊûúÊòæÁ§∫Êó†Êï∞ÊçÆÂåÖÈÄöËøá eth2 ÁΩëÂè£ÔºåËÄå vlan20 Êé•Âè£‰∏äÁõëÂê¨Âà∞ Geneve ÈößÈÅìÊµÅÈáè„ÄÇ

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/compute1-vlan20-tcpdump-geneve-redirect-gateway-chassis.jpg)

    

  - ÈáçÂÆöÂêëÁöÑ Geneve ÈößÈÅìÊï∞ÊçÆÂåÖÈÄöËøá controller0 ËäÇÁÇπ ovs br-int ovn Êé•Âè£Ëß£Â∞ÅË£ÖËøõÂÖ• ovs br-int ÁΩëÊ°•ÔºåÊï∞ÊçÆÂåÖÂú® ovs br-int ÁΩëÊ°•‰∏≠ÂåπÈÖçÁöÑÊµÅË°®ËßÑÂàôÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö

    ```bash
    root@controller0:
     $ ovs-ofctl dump-ports-desc br-int
       OFPST_PORT_DESC reply (xid=0x2):
       ...
       3(ovn-b8bd46-0): addr:0a:d3:dc:0d:16:82
           config:     0
           state:      0
           speed: 0 Mbps now, 0 Mbps max
       ...
       6(patch-br-int-to): addr:56:ba:5f:65:dc:58
           config:     0
           state:      0
           speed: 0 Mbps now, 0 Mbps max
       ...
     # Êü•ÁúãÊé•Êî∂ Geneve ÈößÈÅìÊï∞ÊçÆÂåÖÁöÑ ovn ÈößÈÅìÁ´ØÂè£‰∏éÊï∞ÊçÆÂåÖÂá∫ ovs br-int ÁΩëÊ°•ÁöÑÁ´ØÂè£Á¥¢ÂºïÂè∑
    ```

    ```bash
    $ ovs-ofctl dump-flows br-int
      cookie=0x0, duration=34164.224s, table=0, n_packets=17007, n_bytes=1664991, idle_age=115, priority=100,in_port=3 actions=move:NXM_NX_TUN_ID[0..23]->OXM_OF_METADATA[0..23],move:NXM_NX_TUN_METADATA0[16..30]->NXM_NX_REG14[0..14],move:NXM_NX_TUN_METADATA0[0..15]->NXM_NX_REG15[0..15],resubmit(,33)
      # controller0 ËäÇÁÇπÈÄöËøá 3 Âè∑ ovn ÈößÈÅìÁ´ØÂè£Êé•Êî∂ÈáçÂÆöÂêëÁöÑ Geneve ÈößÈÅìÊï∞ÊçÆÂåÖÂ∞ÜÂÖ∂Ëß£Â∞ÅË£Ö„ÄÇ
      cookie=0xe998b8a, duration=34164.225s, table=33, n_packets=17007, n_bytes=1664991, idle_age=115, priority=100,reg15=0x3,metadata=0x6 actions=load:0x2->NXM_NX_REG15[],load:0x9->NXM_NX_REG11[],load:0x8->NXM_NX_REG12[],resubmit(,34)
      # Êù•Ëá™ OVN ÈÄªËæëË∑ØÁî±Âô®Ôºàmetadata=0x6ÔºâÁöÑÈÄªËæëÂá∫Á´ØÂè£Ôºàreg15=0x3Ôºåcr-lrp-0416a971-ac51-4a5d-80a7-c95d2e397506ÔºâÁöÑÊï∞ÊçÆÂåÖÂ∞Ü‰ªéÈÄªËæëÂá∫Á´ØÂè£Ôºàreg=0x2Ôºålrp-0416a971-ac51-4a5d-80a7-c95d2e397506ÔºâÂèëÂá∫„ÄÇ
      cookie=0x0, duration=34164.225s, table=34, n_packets=73786, n_bytes=7542266, idle_age=115, priority=0 actions=load:0->NXM_NX_REG0[],load:0->NXM_NX_REG1[],load:0->NXM_NX_REG2[],load:0->NXM_NX_REG3[],load:0->NXM_NX_REG4[],load:0->NXM_NX_REG5[],load:0->NXM_NX_REG6[],load:0->NXM_NX_REG7[],load:0->NXM_NX_REG8[],load:0->NXM_NX_REG9[],resubmit(,40)
      cookie=0x7d0c87c1, duration=34164.195s, table=40, n_packets=34458, n_bytes=3409617, idle_age=115, priority=0,metadata=0x6 actions=resubmit(,41)
      cookie=0xd794c1c3, duration=34164.197s, table=41, n_packets=17007, n_bytes=1664991, idle_age=115, priority=153,ip,reg15=0x2,metadata=0x6,nw_src=192.168.1.0/24 actions=ct(commit,table=42,zone=NXM_NX_REG12[0..15],nat(src=172.25.250.139))
      # SNAT: 192.168.1.0/24 -> 172.25.250.139
      cookie=0x65382c1c, duration=34164.197s, table=41, n_packets=17451, n_bytes=1744626, idle_age=115, priority=0,metadata=0x6 actions=resubmit(,42)
      cookie=0x8b136393, duration=34164.197s, table=42, n_packets=34458, n_bytes=3409617, idle_age=115, priority=0,metadata=0x6 actions=resubmit(,43)
      cookie=0x31c0b926, duration=34164.195s, table=43, n_packets=17505, n_bytes=1685907, idle_age=115, priority=100,reg15=0x2,metadata=0x6 actions=resubmit(,64) 
      cookie=0x0, duration=34164.225s, table=64, n_packets=498, n_bytes=20916, idle_age=125, priority=100,reg10=0x1/0x1,reg15=0x2,metadata=0x6 actions=push:NXM_OF_IN_PORT[],load:0xffff->NXM_OF_IN_PORT[],resubmit(,65),pop:NXM_OF_IN_PORT[]
      cookie=0x2665306c, duration=34164.180s, table=65, n_packets=17515, n_bytes=1686327, idle_age=115, priority=100,reg15=0x1,metadata=0x2 actions=output:6
      # Êï∞ÊçÆÂåÖ‰ªé OVN ÈÄªËæëË∑ØÁî±Âô®Ôºàmetadata=0x6ÔºâÁöÑÈÄªËæëÂá∫Á´ØÂè£Ôºàreg15=0x2ÔºâËΩ¨ÂèëËá≥ÂÖ∑Êúâ localnet Á´ØÂè£Á±ªÂûãÁöÑ OVN ÈÄªËæë‰∫§Êç¢Êú∫ÁöÑÈÄªËæëÂá∫Á´ØÂè£Ôºàreg15=0x1ÔºâÔºåÊï∞ÊçÆÂåÖÊúÄÁªàÁªèÁî± ovs br-int ÁΩëÊ°•ÁöÑ 6 Âè∑Á´ØÂè£ÂèëÂá∫„ÄÇ
      # 6 Âè∑Á´ØÂè£‰∏∫ patch Âè£Ôºå‰∏é ovs br-ex ÁΩëÊ°•ÂØπÊé•ÔºåÂÆûÁé∞ OVN ÈÄªËæëÁΩëÁªúËá≥Áâ©ÁêÜÁΩëÁªúÁöÑÊò†Â∞Ñ„ÄÇ
    ```

    ‰∏∫‰∫ÜÈ™åËØÅ‰ª•‰∏äÁªìÊûúÔºåÂàÜÂà´Âú® controller0 ËäÇÁÇπÁöÑ eth2 ÁΩëÂè£ÔºàÂØπÊé• 172.25.250.0/24 Â§ñÈÉ®ÁΩëÁªúÔºâ‰∏é vlan20 Êé•Âè£ÔºàGeneve ÈößÈÅìÁΩëÁªúÔºâ‰∏äÊäìÂåÖÔºåÁªìÊûúÊòæÁ§∫ vlan20 Êé•Âè£ÁõëÂê¨Âà∞‰∫Ü Geneve ÈößÈÅìÊµÅÈáèÔºåeth2 ÁΩëÂè£ÁõëÂê¨Âà∞‰∏éÂ§ñÁΩë‰∫íËÆøÁöÑÊµÅÈáè„ÄÇ
    
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/controller0-vlan20-tcpdump-geneve-redirect-gateway-chassis.jpg) 
    
    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/controller0-eth2-tcpdump-external.jpg)



- ‰ªéÂ§ñÈÉ®Áõ¥Êé•ËÆøÈóÆËÆ°ÁÆóËäÇÁÇπ‰ª•ËÆøÈóÆËøêË°å‰∫éËÆ°ÁÆóËäÇÁÇπ‰πã‰∏äÁöÑÂÖ∑ÊúâÊµÆÂä® IPÔºàfipÔºâÁöÑÂÆû‰æãÔºö

  - `DNAT` ÂäüËÉΩÁöÑÂÆûÁé∞Ôºö

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-dnat-1.png)

    Â§ñÈÉ®ÁΩëÁªúÊï∞ÊçÆÂåÖÈÄöËøá OVS br-int ÈõÜÊàêÁΩëÊ°• **`patch-to-br-int`** Á´ØÂè£ËøõÂÖ• metadata ‰∏∫ **`0x2`** ÁöÑ DatapathÔºàÈÄªËæë‰∫§Êç¢Êú∫Ôºâ‰∏äÁöÑ **`0x1`** ÈÄªËæëÂÖ•Á´ØÂè£„ÄÇ

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-dnat-2.png)

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-dnat-3.png)

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/ovn-dnat-4.png)

    Êï∞ÊçÆÂåÖÈÄöËøá OVS br-int ÁΩëÊ°•ÁöÑÁ´ØÂè£ 4 ËΩ¨ÂèëËá≥ÁõÆÊ†áÂÆû‰æã„ÄÇ

  - Áõ¥Êé•ÂØπÂÆû‰æãÊâÄÂú®ÁöÑËÆ°ÁÆóËäÇÁÇπËøõË°å tcpdump ‰∏é Wireshark ÊäìÂåÖÂàÜÊûêÔºö

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/tcpdump-fip-tenant-1.png)

    ![](https://github.com/Alberthua-Perl/scripts-confs/blob/master/ovn-arch/images/ovn-openstack-openflow-analysis/tcpdump-fip-tenant-2.png)



#### ÂèÇËÄÉÊñáÊ°£Ôºö

- man 8 ovn-nbctlÔºö

  https://man7.org/linux/man-pages/man8/ovn-nbctl.8.html#top_of_page

- Open vSwitch ÂÆòÁΩëÔºö

  http://www.openvswitch.org/
